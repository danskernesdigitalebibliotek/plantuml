<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="553px" preserveAspectRatio="none" style="width:706px;height:553px;" version="1.1" viewBox="0 0 706 553" width="706px" zoomAndPan="magnify"><defs><filter height="300%" id="fgkx2oihz8ie1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="377" x="162.5" y="28.708">Issue 4673 Non-resident patron in Proxy</text><rect fill="#FFFFFF" filter="url(#fgkx2oihz8ie1)" height="342.3984" style="stroke:#000000;stroke-width:2.0;" width="682" x="10" y="150.5156"/><rect fill="#FFFFFF" height="267" style="stroke:none;stroke-width:1.0;" width="682" x="10" y="225.9141"/><rect fill="#FFFFFF" filter="url(#fgkx2oihz8ie1)" height="221.8672" style="stroke:#000000;stroke-width:2.0;" width="662" x="20" y="264.0469"/><rect fill="#FFFFFF" height="117.3359" style="stroke:none;stroke-width:1.0;" width="662" x="20" y="368.5781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="75.25" y2="509.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="353.5" x2="353.5" y1="75.25" y2="509.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="501" x2="501" y1="75.25" y2="509.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="649" x2="649" y1="75.25" y2="509.9141"/><rect fill="#FEFECE" filter="url(#fgkx2oihz8ie1)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="45" x="30" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="37" y="59.9482">CMS</text><rect fill="#FEFECE" filter="url(#fgkx2oihz8ie1)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="45" x="30" y="508.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="37" y="528.9092">CMS</text><rect fill="#FEFECE" filter="url(#fgkx2oihz8ie1)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="54" x="324.5" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="331.5" y="59.9482">Proxy</text><rect fill="#FEFECE" filter="url(#fgkx2oihz8ie1)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="54" x="324.5" y="508.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="331.5" y="528.9092">Proxy</text><rect fill="#FEFECE" filter="url(#fgkx2oihz8ie1)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="51" x="474" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="481" y="59.9482">CULR</text><rect fill="#FEFECE" filter="url(#fgkx2oihz8ie1)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="51" x="474" y="508.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="481" y="528.9092">CULR</text><rect fill="#FEFECE" filter="url(#fgkx2oihz8ie1)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="41" x="627" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="634" y="59.9482">FBS</text><rect fill="#FEFECE" filter="url(#fgkx2oihz8ie1)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="41" x="627" y="508.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="634" y="528.9092">FBS</text><polygon fill="#A80036" points="341.5,102.3828,351.5,106.3828,341.5,110.3828,345.5,106.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54.5" x2="347.5" y1="106.3828" y2="106.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="61.5" y="101.3169">Login</text><polygon fill="#A80036" points="489.5,131.5156,499.5,135.5156,489.5,139.5156,493.5,135.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="353.5" x2="495.5" y1="135.5156" y2="135.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="360.5" y="130.4497">Resident patron?</text><path d="M10,150.5156 L76,150.5156 L76,157.5156 L66,167.5156 L10,167.5156 L10,150.5156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="342.3984" style="stroke:#000000;stroke-width:2.0;" width="682" x="10" y="150.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="163.5825">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="143" x="91" y="162.7261">[Yes resident patron]</text><polygon fill="#A80036" points="364.5,184.7813,354.5,188.7813,364.5,192.7813,360.5,188.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="358.5" x2="500.5" y1="188.7813" y2="188.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="370.5" y="183.7153">Login</text><polygon fill="#A80036" points="65.5,213.9141,55.5,217.9141,65.5,221.9141,61.5,217.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="59.5" x2="352.5" y1="217.9141" y2="217.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="71.5" y="212.8481">Login</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="692" y1="226.9141" y2="226.9141"/><polygon fill="#A80036" points="637.5,245.0469,647.5,249.0469,637.5,253.0469,641.5,249.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="501.5" x2="643.5" y1="249.0469" y2="249.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="508.5" y="243.981">Resident patron?</text><path d="M20,264.0469 L86,264.0469 L86,271.0469 L76,281.0469 L20,281.0469 L20,264.0469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="221.8672" style="stroke:#000000;stroke-width:2.0;" width="662" x="20" y="264.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="277.1138">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="171" x="101" y="276.2573">[Yes resident FBS patron]</text><polygon fill="#A80036" points="512.5,298.3125,502.5,302.3125,512.5,306.3125,508.5,302.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="506.5" x2="648.5" y1="302.3125" y2="302.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="518.5" y="297.2466">Resident patron</text><polygon fill="#A80036" points="364.5,327.4453,354.5,331.4453,364.5,335.4453,360.5,331.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="358.5" x2="500.5" y1="331.4453" y2="331.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="370.5" y="326.3794">Login</text><polygon fill="#A80036" points="65.5,356.5781,55.5,360.5781,65.5,364.5781,61.5,360.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="59.5" x2="352.5" y1="360.5781" y2="360.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="71.5" y="355.5122">Login</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="682" y1="369.5781" y2="369.5781"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="176" x="25" y="379.7886">[No - Not resident patron]</text><polygon fill="#A80036" points="512.5,400.5156,502.5,404.5156,512.5,408.5156,508.5,404.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="506.5" x2="648.5" y1="404.5156" y2="404.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="518.5" y="399.4497">Not resident patron</text><polygon fill="#A80036" points="364.5,429.6484,354.5,433.6484,364.5,437.6484,360.5,433.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="358.5" x2="500.5" y1="433.6484" y2="433.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="370.5" y="428.5825">Not resident patron</text><polygon fill="#A80036" points="65.5,473.9141,55.5,477.9141,65.5,481.9141,61.5,477.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="59.5" x2="352.5" y1="477.9141" y2="477.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="71.5" y="457.7153">Ask patron for redirect to home agency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="71.5" y="472.8481">(Using CURL agency list and resident code)</text><!--MD5=[cfa9fd35eaf67a490761802a17f576be]
@startuml
title Issue 4673 Non-resident patron in Proxy
'https://platform.dandigbib.org/issues/4673

CMS -> Proxy: Login
Proxy -> CULR: Resident patron?
alt Yes resident patron
    Proxy <- - CULR: Login
    CMS <- - Proxy: Login
else
    CULR -> FBS: Resident patron?
    alt Yes resident FBS patron
        CULR <- FBS: Resident patron
        Proxy <- - CULR: Login
    CMS <- - Proxy: Login
    else No - Not resident patron
        CULR <- FBS: Not resident patron
        Proxy <- - CULR: Not resident patron
        'Ask patron for redirect to home agency\n(Using CURL agency list and resident code)
        CMS <- - Proxy: Ask patron for redirect to home agency\n(Using CURL agency list and resident code)
    end
end
@enduml

@startuml
title Issue 4673 Non-resident patron in Proxy

CMS -> Proxy: Login
Proxy -> CULR: Resident patron?
alt Yes resident patron
    Proxy <- - CULR: Login
    CMS <- - Proxy: Login
else
    CULR -> FBS: Resident patron?
    alt Yes resident FBS patron
        CULR <- FBS: Resident patron
        Proxy <- - CULR: Login
    CMS <- - Proxy: Login
    else No - Not resident patron
        CULR <- FBS: Not resident patron
        Proxy <- - CULR: Not resident patron
        CMS <- - Proxy: Ask patron for redirect to home agency\n(Using CURL agency list and resident code)
    end
end
@enduml

PlantUML version 1.2020.27beta8(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>