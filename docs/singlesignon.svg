<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1175px" preserveAspectRatio="none" style="width:1083px;height:1175px;background:#FFFFFF;" version="1.1" viewBox="0 0 1083 1175" width="1083px" zoomAndPan="magnify"><defs><filter height="300%" id="f43gjokrjzuxy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="129" x="475.25" y="28.708">Single sign-on</text><rect fill="#FFFFFF" filter="url(#f43gjokrjzuxy)" height="846.3359" style="stroke:#000000;stroke-width:2.0;" width="1059.5" x="10" y="227.6484"/><rect fill="#FFFFFF" height="740.6719" style="stroke:none;stroke-width:1.0;" width="1059.5" x="10" y="333.3125"/><rect fill="#FFFFFF" filter="url(#f43gjokrjzuxy)" height="462.5391" style="stroke:#000000;stroke-width:2.0;" width="881.5" x="178" y="604.4453"/><rect fill="#FFFFFF" height="387.1406" style="stroke:none;stroke-width:1.0;" width="881.5" x="178" y="679.8438"/><rect fill="#FFFFFF" filter="url(#f43gjokrjzuxy)" height="143.2734" style="stroke:#000000;stroke-width:2.0;" width="278" x="771.5" y="759.9141"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="47" x2="47" y1="123.25" y2="1090.9844"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="220" x2="220" y1="123.25" y2="1090.9844"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="334.5" x2="334.5" y1="123.25" y2="1090.9844"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="564.5" x2="564.5" y1="123.25" y2="1090.9844"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="737.5" x2="737.5" y1="123.25" y2="1090.9844"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="805.5" x2="805.5" y1="123.25" y2="1090.9844"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1014.5" x2="1014.5" y1="123.25" y2="1090.9844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="20" y="119.9482">Patron</text><ellipse cx="47" cy="49.9531" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="8" ry="8" style="stroke:#383838;stroke-width:2.0;"/><path d="M47,57.9531 L47,84.9531 M34,65.9531 L60,65.9531 M47,84.9531 L34,99.9531 M47,84.9531 L60,99.9531 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="20" y="1102.9795">Patron</text><ellipse cx="47" cy="1116.2813" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="8" ry="8" style="stroke:#383838;stroke-width:2.0;"/><path d="M47,1124.2813 L47,1151.2813 M34,1132.2813 L60,1132.2813 M47,1151.2813 L34,1166.2813 M47,1151.2813 L60,1166.2813 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="188" y="119.9482">Browser</text><path d="M199.5,78.9531 L199.5,102.9531 M199.5,90.9531 L216.5,90.9531 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><ellipse cx="228.5" cy="90.9531" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="188" y="1102.9795">Browser</text><path d="M199.5,1110.2813 L199.5,1134.2813 M199.5,1122.2813 L216.5,1122.2813 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><ellipse cx="228.5" cy="1122.2813" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="298.5" y="119.9482">DDB CMS</text><ellipse cx="335" cy="90.9531" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><line style="stroke:#383838;stroke-width:2.0;" x1="323" x2="347" y1="104.9531" y2="104.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="298.5" y="1102.9795">DDB CMS</text><ellipse cx="335" cy="1122.2813" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><line style="stroke:#383838;stroke-width:2.0;" x1="323" x2="347" y1="1136.2813" y2="1136.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="518.5" y="119.9482">login.bib.dk</text><ellipse cx="565" cy="90.9531" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><polygon fill="#383838" points="561,78.9531,567,73.9531,565,78.9531,567,83.9531,561,78.9531" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="518.5" y="1102.9795">login.bib.dk</text><ellipse cx="565" cy="1122.2813" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><polygon fill="#383838" points="561,1110.2813,567,1105.2813,565,1110.2813,567,1115.2813,561,1110.2813" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="704.5" y="119.9482">BORCHK</text><path d="M717.5,78.9531 L717.5,102.9531 M717.5,90.9531 L734.5,90.9531 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><ellipse cx="746.5" cy="90.9531" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="704.5" y="1102.9795">BORCHK</text><path d="M717.5,1110.2813 L717.5,1134.2813 M717.5,1122.2813 L734.5,1122.2813 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><ellipse cx="746.5" cy="1122.2813" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="784.5" y="119.9482">CULR</text><path d="M785.5,78.9531 L785.5,102.9531 M785.5,90.9531 L802.5,90.9531 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><ellipse cx="814.5" cy="90.9531" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="784.5" y="1102.9795">CULR</text><path d="M785.5,1110.2813 L785.5,1134.2813 M785.5,1122.2813 L802.5,1122.2813 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><ellipse cx="814.5" cy="1122.2813" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="997.5" y="119.9482">LMS</text><path d="M994.5,78.9531 L994.5,102.9531 M994.5,90.9531 L1011.5,90.9531 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><ellipse cx="1023.5" cy="90.9531" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="997.5" y="1102.9795">LMS</text><path d="M994.5,1110.2813 L994.5,1134.2813 M994.5,1122.2813 L1011.5,1122.2813 " fill="none" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:2.0;"/><ellipse cx="1023.5" cy="1122.2813" fill="#F8F8F8" filter="url(#f43gjokrjzuxy)" rx="12" ry="12" style="stroke:#383838;stroke-width:2.0;"/><polygon fill="#383838" points="208,150.3828,218,154.3828,208,158.3828,212,154.3828" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="47" x2="214" y1="154.3828" y2="154.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="54" y="149.3169">Log in</text><polygon fill="#383838" points="323,179.5156,333,183.5156,323,187.5156,327,183.5156" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="220" x2="329" y1="183.5156" y2="183.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="227" y="178.4497">Log in</text><polygon fill="#383838" points="553,208.6484,563,212.6484,553,216.6484,557,212.6484" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="335" x2="559" y1="212.6484" y2="212.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="342" y="207.5825">Request authentification of user</text><path d="M10,227.6484 L76,227.6484 L76,234.6484 L66,244.6484 L10,244.6484 L10,227.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="846.3359" style="stroke:#000000;stroke-width:2.0;" width="1059.5" x="10" y="227.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="240.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="268" x="91" y="239.8589">[User is already logged in (login cookie)]</text><polygon fill="#383838" points="346,292.1797,336,296.1797,346,300.1797,342,296.1797" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="340" x2="564" y1="296.1797" y2="296.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="352" y="260.8481">Return GUID, session token,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="352" y="275.981">muncipality ID and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="352" y="291.1138">active agencies for userID</text><path d="M570,252.3477 L570,292.3477 L929,292.3477 L929,262.3477 L919,252.3477 L570,252.3477 " fill="#EBEBEB" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:1.0;"/><path d="M919,252.3477 L919,262.3477 L929,262.3477 L919,252.3477 " fill="#EBEBEB" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="576" y="269.4146">If profile was created on login,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338" x="576" y="284.5474">login agency is the only returned for userID@Agency</text><polygon fill="#383838" points="231,321.3125,221,325.3125,231,329.3125,227,325.3125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="225" x2="334" y1="325.3125" y2="325.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="237" y="320.2466">User logged in</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1069.5" y1="334.3125" y2="334.3125"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="102" x="15" y="344.5229">[Login process]</text><polygon fill="#383838" points="231,365.25,221,369.25,231,373.25,227,369.25" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="225" x2="564" y1="369.25" y2="369.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="237" y="364.1841">Get Agency, userID and PIN</text><polygon fill="#383838" points="58,409.5156,48,413.5156,58,417.5156,54,413.5156" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="52" x2="219" y1="413.5156" y2="413.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="64" y="393.3169">Enter Agency,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="64" y="408.4497">userID and PIN</text><polygon fill="#383838" points="208,438.6484,218,442.6484,208,446.6484,212,442.6484" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="47" x2="214" y1="442.6484" y2="442.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="54" y="437.5825">Agency, userID and PIN</text><polygon fill="#383838" points="553,482.9141,563,486.9141,553,490.9141,557,486.9141" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="220" x2="559" y1="486.9141" y2="486.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="231" y="466.7153"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="227" y="481.8481">Agency, userID and PIN</text><polygon fill="#383838" points="726,512.0469,736,516.0469,726,520.0469,730,516.0469" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="565" x2="732" y1="516.0469" y2="516.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="572" y="510.981">Agency, userID and PIN</text><polygon fill="#383838" points="1003,556.3125,1013,560.3125,1003,564.3125,1007,560.3125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="738" x2="1009" y1="560.3125" y2="560.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="745" y="540.1138">Authenticate:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="745" y="555.2466">Agency, userID and PIN</text><polygon fill="#383838" points="749,585.4453,739,589.4453,749,593.4453,745,589.4453" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="743" x2="1014" y1="589.4453" y2="589.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="755" y="584.3794">TRUE/FALSE</text><path d="M178,604.4453 L244,604.4453 L244,611.4453 L234,621.4453 L178,621.4453 L178,604.4453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="462.5391" style="stroke:#000000;stroke-width:2.0;" width="881.5" x="178" y="604.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="193" y="617.5122">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="213" x="259" y="616.6558">[BORCHK: FALSE (User rejected)]</text><polygon fill="#383838" points="576,638.7109,566,642.7109,576,646.7109,572,642.7109" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="570" x2="737" y1="642.7109" y2="642.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="582" y="637.645">User rejected</text><polygon fill="#383838" points="231,667.8438,221,671.8438,231,675.8438,227,671.8438" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="225" x2="564" y1="671.8438" y2="671.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="237" y="666.7778">Login failed</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="178" x2="1059.5" y1="680.8438" y2="680.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="248" x="183" y="691.0542">[BORCHK: TRUE (User authenticated)]</text><polygon fill="#383838" points="576,711.7813,566,715.7813,576,719.7813,572,715.7813" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="570" x2="737" y1="715.7813" y2="715.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="582" y="710.7153">User authenticated</text><polygon fill="#383838" points="794,740.9141,804,744.9141,794,748.9141,798,744.9141" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="565" x2="800" y1="744.9141" y2="744.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="572" y="739.8481">Get profile for userID@Agency</text><path d="M771.5,759.9141 L837.5,759.9141 L837.5,766.9141 L827.5,776.9141 L771.5,776.9141 L771.5,759.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="143.2734" style="stroke:#000000;stroke-width:2.0;" width="278" x="771.5" y="759.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="786.5" y="772.981">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="134" x="852.5" y="772.1245">[Create user profile</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="141" x="852.5" y="784.9292">if not found in CULR]</text><polygon fill="#383838" points="1003,804.7891,1013,808.7891,1003,812.7891,1007,808.7891" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="806" x2="1009" y1="808.7891" y2="808.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="813" y="803.7231">Get user profile</text><polygon fill="#383838" points="817,833.9219,807,837.9219,817,841.9219,813,837.9219" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="811" x2="1014" y1="837.9219" y2="837.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="823" y="832.856">UserID, MunicipalityNo</text><line style="stroke:#383838;stroke-width:1.0;" x1="806" x2="848" y1="882.1875" y2="882.1875"/><line style="stroke:#383838;stroke-width:1.0;" x1="848" x2="848" y1="882.1875" y2="895.1875"/><line style="stroke:#383838;stroke-width:1.0;" x1="807" x2="848" y1="895.1875" y2="895.1875"/><polygon fill="#383838" points="817,891.1875,807,895.1875,817,899.1875,813,895.1875" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="813" y="861.9888">Create profile (GUID)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="813" y="877.1216">for agency with MunicipalityNo</text><polygon fill="#383838" points="576,942.4531,566,946.4531,576,950.4531,572,946.4531" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="570" x2="805" y1="946.4531" y2="946.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="582" y="926.2544">Return GUID and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="582" y="941.3872">active agencies for userID</text><polygon fill="#383838" points="231,971.5859,221,975.5859,231,979.5859,227,975.5859" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="225" x2="564" y1="975.5859" y2="975.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="237" y="970.52">Set login cookie (User Token)</text><polygon fill="#383838" points="346,1015.8516,336,1019.8516,346,1023.8516,342,1019.8516" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="340" x2="564" y1="1019.8516" y2="1019.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="352" y="999.6528">Return GUID, session token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="352" y="1014.7856">and active agencies for userI</text><path d="M570,991.1523 L570,1016.1523 L897,1016.1523 L897,1001.1523 L887,991.1523 L570,991.1523 " fill="#EBEBEB" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:1.0;"/><path d="M887,991.1523 L887,1001.1523 L897,1001.1523 L887,991.1523 " fill="#EBEBEB" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="576" y="1008.2192">+ additional info configured (CPR, Local user ID)</text><polygon fill="#383838" points="231,1049.9844,221,1053.9844,231,1057.9844,227,1053.9844" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="334" y1="1053.9844" y2="1053.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="237" y="1048.9185">User logged in</text><path d="M340,1032.8516 L340,1057.8516 L606,1057.8516 L606,1042.8516 L596,1032.8516 L340,1032.8516 " fill="#EBEBEB" filter="url(#f43gjokrjzuxy)" style="stroke:#383838;stroke-width:1.0;"/><path d="M596,1032.8516 L596,1042.8516 L606,1042.8516 L596,1032.8516 " fill="#EBEBEB" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="346" y="1049.9185">Ready to get more user info from LMS</text><!--MD5=[2a3bf26c50719b9dd1b0ea9954064e48]
@startuml
title Single sign-on

' Skinparams '
skinparam monochrome true

' Participants
actor Patron
boundary Browser
entity DDBCMS as "DDB CMS"
control login.bib.dk /' "AccessPlatform" '/
boundary BORCHK /' as "Borrower Check" '/
            
boundary CULR
boundary LMS /'as "Library Management System" '/

Patron->Browser: Log in
Browser->DDBCMS: Log in
DDBCMS->login.bib.dk: Request authentification of user

alt User is already logged in (login cookie)
    login.bib.dk->DDBCMS: Return GUID, session token, \nmuncipality ID and \nactive agencies for userID
            note right: If profile was created on login, \nlogin agency is the only returned for userID@Agency
    DDBCMS->Browser: User logged in
else Login process
    login.bib.dk->Browser: Get Agency, userID and PIN
    Browser->Patron: Enter Agency,\nuserID and PIN
    Patron->Browser: Agency, userID and PIN
    Browser->login.bib.dk: \nAgency, userID and PIN

    login.bib.dk->BORCHK: Agency, userID and PIN

    BORCHK->LMS: Authenticate: \nAgency, userID and PIN
    LMS- ->BORCHK: TRUE/FALSE

    alt BORCHK: FALSE (User rejected)
        BORCHK->login.bib.dk: User rejected
        login.bib.dk->Browser: Login failed
    else BORCHK: TRUE (User authenticated)
        BORCHK->login.bib.dk: User authenticated
        login.bib.dk->CULR: Get profile for userID@Agency
                               
            'note right: Profile with new GUID for userID@Agency \nis created if user not found in CULR. \nMuncipalityNo requested from LMS
            alt Create user profile \nif not found in CULR
                CULR -> LMS: Get user profile
                CULR <- - LMS: UserID, MunicipalityNo
                CULR->CULR: Create profile (GUID) \nfor agency with MunicipalityNo
            end
        login.bib.dk<- -CULR: Return GUID and \nactive agencies for userID
        login.bib.dk->Browser: Set login cookie (User Token)
        login.bib.dk->DDBCMS: Return GUID, session token\nand active agencies for userI
            note right:+ additional info configured (CPR, Local user ID)
        DDBCMS- ->Browser: User logged in
            note right: Ready to get more user info from LMS
    end
end
@enduml

@startuml
title Single sign-on

skinparam monochrome true

actor Patron
boundary Browser
entity DDBCMS as "DDB CMS"
control login.bib.dk 
boundary BORCHK 
            
boundary CULR
boundary LMS 

Patron->Browser: Log in
Browser->DDBCMS: Log in
DDBCMS->login.bib.dk: Request authentification of user

alt User is already logged in (login cookie)
    login.bib.dk->DDBCMS: Return GUID, session token, \nmuncipality ID and \nactive agencies for userID
            note right: If profile was created on login, \nlogin agency is the only returned for userID@Agency
    DDBCMS->Browser: User logged in
else Login process
    login.bib.dk->Browser: Get Agency, userID and PIN
    Browser->Patron: Enter Agency,\nuserID and PIN
    Patron->Browser: Agency, userID and PIN
    Browser->login.bib.dk: \nAgency, userID and PIN

    login.bib.dk->BORCHK: Agency, userID and PIN

    BORCHK->LMS: Authenticate: \nAgency, userID and PIN
    LMS- ->BORCHK: TRUE/FALSE

    alt BORCHK: FALSE (User rejected)
        BORCHK->login.bib.dk: User rejected
        login.bib.dk->Browser: Login failed
    else BORCHK: TRUE (User authenticated)
        BORCHK->login.bib.dk: User authenticated
        login.bib.dk->CULR: Get profile for userID@Agency
                               
            alt Create user profile \nif not found in CULR
                CULR -> LMS: Get user profile
                CULR <- - LMS: UserID, MunicipalityNo
                CULR->CULR: Create profile (GUID) \nfor agency with MunicipalityNo
            end
        login.bib.dk<- -CULR: Return GUID and \nactive agencies for userID
        login.bib.dk->Browser: Set login cookie (User Token)
        login.bib.dk->DDBCMS: Return GUID, session token\nand active agencies for userI
            note right:+ additional info configured (CPR, Local user ID)
        DDBCMS- ->Browser: User logged in
            note right: Ready to get more user info from LMS
    end
end
@enduml

PlantUML version 1.2021.11beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>