<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1067px" preserveAspectRatio="none" style="width:1021px;height:1067px;" version="1.1" viewBox="0 0 1021 1067" width="1021px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wb9tmtgnjr9y" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="287" x="363.75" y="43.3486">Login DFD - Sequence Diagram</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="379" x="317.75" y="1059.2451">DDB CMS User authentification (Adgangsplatformen)</text><rect fill="#FFFFFF" filter="url(#f1wb9tmtgnjr9y)" height="568.3281" style="stroke: #000000; stroke-width: 2.0;" width="872.5" x="10" y="154.8906"/><rect fill="#FFFFFF" filter="url(#f1wb9tmtgnjr9y)" height="478.9297" style="stroke: #000000; stroke-width: 2.0;" width="852.5" x="20" y="237.2891"/><rect fill="#FFFFFF" height="247.8672" style="stroke: none; stroke-width: 1.0;" width="852.5" x="20" y="468.3516"/><rect fill="#FFFFFF" filter="url(#f1wb9tmtgnjr9y)" height="208.7344" style="stroke: #000000; stroke-width: 2.0;" width="778" x="226.5" y="737.2188"/><rect fill="#FFFFFF" filter="url(#f1wb9tmtgnjr9y)" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="758" x="236.5" y="761.3516"/><rect fill="#FFFFFF" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="758" x="236.5" y="807.6172"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="200" x2="200" y1="137.8906" y2="962.9531"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="270.5" x2="270.5" y1="137.8906" y2="962.9531"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="670.5" x2="670.5" y1="137.8906" y2="962.9531"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="766.5" x2="766.5" y1="137.8906" y2="962.9531"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="832.5" x2="832.5" y1="137.8906" y2="962.9531"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="898.5" x2="898.5" y1="137.8906" y2="962.9531"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="959.5" x2="959.5" y1="137.8906" y2="962.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="173" y="134.5889">Patron</text><ellipse cx="200" cy="64.5938" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M200,72.5938 L200,99.5938 M187,80.5938 L213,80.5938 M200,99.5938 L187,114.5938 M200,99.5938 L213,114.5938 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="173" y="974.9482">Patron</text><ellipse cx="200" cy="988.25" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M200,996.25 L200,1023.25 M187,1004.25 L213,1004.25 M200,1023.25 L187,1038.25 M200,1023.25 L213,1038.25 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="252.5" y="134.5889">CMS</text><path d="M250.5,93.5938 L250.5,117.5938 M250.5,105.5938 L267.5,105.5938 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><ellipse cx="279.5" cy="105.5938" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="12" ry="12" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="252.5" y="974.9482">CMS</text><path d="M250.5,982.25 L250.5,1006.25 M250.5,994.25 L267.5,994.25 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><ellipse cx="279.5" cy="994.25" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="12" ry="12" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="611.5" y="134.5889">Accessplatform</text><path d="M650.5,93.5938 L650.5,117.5938 M650.5,105.5938 L667.5,105.5938 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><ellipse cx="679.5" cy="105.5938" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="12" ry="12" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="611.5" y="974.9482">Accessplatform</text><path d="M650.5,982.25 L650.5,1006.25 M650.5,994.25 L667.5,994.25 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><ellipse cx="679.5" cy="994.25" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="12" ry="12" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="740.5" y="134.5889">NemId</text><path d="M746,93.5938 L746,117.5938 M746,105.5938 L763,105.5938 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><ellipse cx="775" cy="105.5938" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="12" ry="12" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="740.5" y="974.9482">NemId</text><path d="M746,982.25 L746,1006.25 M746,994.25 L763,994.25 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><ellipse cx="775" cy="994.25" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="12" ry="12" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="802.5" y="134.5889">Session</text><path d="M814.5,85.5938 C814.5,75.5938 832.5,75.5938 832.5,75.5938 C832.5,75.5938 850.5,75.5938 850.5,85.5938 L850.5,111.5938 C850.5,121.5938 832.5,121.5938 832.5,121.5938 C832.5,121.5938 814.5,121.5938 814.5,111.5938 L814.5,85.5938 " fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M814.5,85.5938 C814.5,95.5938 832.5,95.5938 832.5,95.5938 C832.5,95.5938 850.5,95.5938 850.5,85.5938 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="802.5" y="974.9482">Session</text><path d="M814.5,988.25 C814.5,978.25 832.5,978.25 832.5,978.25 C832.5,978.25 850.5,978.25 850.5,988.25 L850.5,1014.25 C850.5,1024.25 832.5,1024.25 832.5,1024.25 C832.5,1024.25 814.5,1024.25 814.5,1014.25 L814.5,988.25 " fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M814.5,988.25 C814.5,998.25 832.5,998.25 832.5,998.25 C832.5,998.25 850.5,998.25 850.5,988.25 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="872.5" y="134.5889">Drupal</text><path d="M881,85.5938 C881,75.5938 899,75.5938 899,75.5938 C899,75.5938 917,75.5938 917,85.5938 L917,111.5938 C917,121.5938 899,121.5938 899,121.5938 C899,121.5938 881,121.5938 881,111.5938 L881,85.5938 " fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M881,85.5938 C881,95.5938 899,95.5938 899,95.5938 C899,95.5938 917,95.5938 917,85.5938 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="872.5" y="974.9482">Drupal</text><path d="M881,988.25 C881,978.25 899,978.25 899,978.25 C899,978.25 917,978.25 917,988.25 L917,1014.25 C917,1024.25 899,1024.25 899,1024.25 C899,1024.25 881,1024.25 881,1014.25 L881,988.25 " fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M881,988.25 C881,998.25 899,998.25 899,998.25 C899,998.25 917,998.25 917,988.25 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="942.5" y="134.5889">LMS</text><path d="M939.5,93.5938 L939.5,117.5938 M939.5,105.5938 L956.5,105.5938 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><ellipse cx="968.5" cy="105.5938" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="12" ry="12" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="942.5" y="974.9482">LMS</text><path d="M939.5,982.25 L939.5,1006.25 M939.5,994.25 L956.5,994.25 " fill="none" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 2.0;"/><ellipse cx="968.5" cy="994.25" fill="#F8F8F8" filter="url(#f1wb9tmtgnjr9y)" rx="12" ry="12" style="stroke: #383838; stroke-width: 2.0;"/><path d="M10,154.8906 L135,154.8906 L135,161.8906 L125,171.8906 L10,171.8906 L10,154.8906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="568.3281" style="stroke: #000000; stroke-width: 2.0;" width="872.5" x="10" y="154.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="25" y="167.9575">Basic login</text><polygon fill="#383838" points="259,189.1563,269,193.1563,259,197.1563,263,193.1563" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="200" x2="265" y1="193.1563" y2="193.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="207" y="188.0903">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="220" y="188.0903">Login</text><polygon fill="#383838" points="659,218.2891,669,222.2891,659,226.2891,663,222.2891" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="665" y1="222.2891" y2="222.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="278" y="217.2231">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="291" y="217.2231">Elevated Client Id + Agency</text><path d="M20,237.2891 L86,237.2891 L86,244.2891 L76,254.2891 L20,254.2891 L20,237.2891 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="478.9297" style="stroke: #000000; stroke-width: 2.0;" width="852.5" x="20" y="237.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="35" y="250.356">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="101" y="249.4995">[NemId login]</text><polygon fill="#383838" points="754.5,271.5547,764.5,275.5547,754.5,279.5547,758.5,275.5547" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="671" x2="760.5" y1="275.5547" y2="275.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="678" y="270.4888">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="694" y="270.4888"/><polygon fill="#383838" points="211,300.6875,201,304.6875,211,308.6875,207,304.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="205" x2="765.5" y1="304.6875" y2="304.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="217" y="299.6216">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="230" y="299.6216">Login</text><polygon fill="#383838" points="754.5,329.8203,764.5,333.8203,754.5,337.8203,758.5,333.8203" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="200" x2="760.5" y1="333.8203" y2="333.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="207" y="328.7544">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="220" y="328.7544">NemId id + key</text><polygon fill="#383838" points="682,358.9531,672,362.9531,682,366.9531,678,362.9531" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="676" x2="765.5" y1="362.9531" y2="362.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="688" y="357.8872">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="701" y="357.8872">CPR</text><polygon fill="#383838" points="282,388.0859,272,392.0859,282,396.0859,278,392.0859" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="276" x2="670" y1="392.0859" y2="392.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="288" y="387.02">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="301" y="387.02">Authorization code</text><polygon fill="#383838" points="659,417.2188,669,421.2188,659,425.2188,663,421.2188" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="665" y1="421.2188" y2="421.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="278" y="416.1528">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="291" y="416.1528">Authorization code + Client Id and Client Secret</text><polygon fill="#383838" points="282,451.3516,272,455.3516,282,459.3516,278,455.3516" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="276" x2="670" y1="455.3516" y2="455.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="288" y="450.2856">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="301" y="450.2856">Access token</text><path d="M30,434.2188 L30,459.2188 L262,459.2188 L262,444.2188 L252,434.2188 L30,434.2188 " fill="#ECECEC" filter="url(#f1wb9tmtgnjr9y)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M252,434.2188 L252,444.2188 L262,444.2188 L252,434.2188 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="36" y="451.2856">Normal User token not retrieved!</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="20" x2="872.5" y1="469.3516" y2="469.3516"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="25" y="479.562">[Library login]</text><polygon fill="#383838" points="211,500.2891,201,504.2891,211,508.2891,207,504.2891" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="205" x2="670" y1="504.2891" y2="504.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="217" y="499.2231">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="240" y="499.2231">Login</text><polygon fill="#383838" points="659,529.4219,669,533.4219,659,537.4219,663,533.4219" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="200" x2="665" y1="533.4219" y2="533.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="207" y="528.356">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="229" y="528.356">id + pin</text><polygon fill="#383838" points="282,558.5547,272,562.5547,282,566.5547,278,562.5547" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="276" x2="670" y1="562.5547" y2="562.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="288" y="557.4888">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="310" y="557.4888">Authorization code</text><polygon fill="#383838" points="659,587.6875,669,591.6875,659,595.6875,663,591.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="665" y1="591.6875" y2="591.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="278" y="586.6216">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="299" y="586.6216">Authorization code + Client Id and Client Secret</text><polygon fill="#383838" points="282,616.8203,272,620.8203,282,624.8203,278,620.8203" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="276" x2="670" y1="620.8203" y2="620.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="288" y="615.7544">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="310" y="615.7544">Access token</text><polygon fill="#383838" points="659,645.9531,669,649.9531,659,653.9531,663,649.9531" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="665" y1="649.9531" y2="649.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="278" y="644.8872">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="300" y="644.8872">Normal Client Id and Client Secret, userid + pin, Agency</text><polygon fill="#383838" points="282,675.0859,272,679.0859,282,683.0859,278,679.0859" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="276" x2="670" y1="679.0859" y2="679.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="288" y="674.02">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="310" y="674.02">User access token</text><polygon fill="#383838" points="820.5,704.2188,830.5,708.2188,820.5,712.2188,824.5,708.2188" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="826.5" y1="708.2188" y2="708.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="278" y="703.1528">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="300" y="703.1528">User access token</text><path d="M226.5,737.2188 L477.5,737.2188 L477.5,744.2188 L467.5,754.2188 L226.5,754.2188 L226.5,737.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="208.7344" style="stroke: #000000; stroke-width: 2.0;" width="778" x="226.5" y="737.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="206" x="241.5" y="750.2856">Get Patron Data from LMS</text><path d="M236.5,761.3516 L302.5,761.3516 L302.5,768.3516 L292.5,778.3516 L236.5,778.3516 L236.5,761.3516 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="758" x="236.5" y="761.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="251.5" y="774.4185">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="95" x="317.5" y="773.562">[UserId = CPR]</text><polygon fill="#383838" points="948,795.6172,958,799.6172,948,803.6172,952,799.6172" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="954" y1="799.6172" y2="799.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="278" y="794.5513">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="300" y="794.5513">(Preauth) CPR, Agency</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="236.5" x2="994.5" y1="808.6172" y2="808.6172"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="241.5" y="818.8276">[No CPR]</text><polygon fill="#383838" points="948,839.5547,958,843.5547,948,847.5547,952,843.5547" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="954" y1="843.5547" y2="843.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="278" y="838.4888">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="300" y="838.4888">UserId +</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="358" y="838.4888">pin</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="380" y="838.4888">, Agency</text><polygon fill="#383838" points="282,875.6875,272,879.6875,282,883.6875,278,879.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="276" x2="959" y1="879.6875" y2="879.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="288" y="874.6216">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="311" y="874.6216">LMS Patron Data</text><polygon fill="#383838" points="820.5,904.8203,830.5,908.8203,820.5,912.8203,824.5,908.8203" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="826.5" y1="908.8203" y2="908.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="278" y="903.7544">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="300" y="903.7544">Userid, LMS Patron Data</text><polygon fill="#383838" points="887,933.9531,897,937.9531,887,941.9531,891,937.9531" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="271" x2="893" y1="937.9531" y2="937.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="278" y="932.8872">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="300" y="932.8872">Userid (hashed), LMS Patron Data (Name, email, blockings)</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="150" x="864.5" y="14.2822">After Simon Holt: Login DFD</text><!--MD5=[7c9a6a8ae9f7c7c288d8e31d297f7be7]
@startuml
title Login DFD - Sequence Diagram
header After Simon Holt: Login DFD
caption DDB CMS User authentification (Adgangsplatformen)

' Skinparams '
skinparam monochrome true
autonumber

actor "Patron" as USER
boundary CMS
boundary Accessplatform as AP
boundary NemId as NEMID
'control "Shopping Cart" as SC
database "Session" as SESSION
database "Drupal" as DRUPAL
boundary LMS
'"Library\nManagemt\nSystem" as LMS


group Basic login

    USER -> CMS: Login
    CMS -> AP: Elevated Client Id + Agency
    
    alt NemId login
        AP -> NEMID:
        NEMID -> USER: Login
        NEMID <- - USER: NemId id + key
        AP <- - NEMID: CPR
        CMS <- - AP: Authorization code
        CMS -> AP:  Authorization code + Client Id and Client Secret
        CMS <- - AP: Access token
        note left 
            Normal User token not retrieved!
        end note
    else Library login
        AP -> USER: Login
        AP  <- - USER: id + pin
        CMS <- - AP: Authorization code
        CMS -> AP:  Authorization code + Client Id and Client Secret
        CMS <- - AP: Access token
        CMS -> AP:  Normal Client Id and Client Secret, userid + pin, Agency
        CMS <- - AP: User access token
        CMS -> SESSION: User access token
    
    end
end

group Get Patron Data from LMS
    alt UserId = CPR
        CMS -> LMS: (Preauth) CPR, Agency
    else No CPR
        CMS -> LMS: UserId + **~~pin~~**, Agency
    end
    CMS <- - LMS: LMS Patron Data
    CMS -> SESSION: Userid, LMS Patron Data
    CMS -> DRUPAL: Userid (hashed), LMS Patron Data (Name, email, blockings)
end
@enduml

@startuml
title Login DFD - Sequence Diagram
header After Simon Holt: Login DFD
caption DDB CMS User authentification (Adgangsplatformen)

skinparam monochrome true
autonumber

actor "Patron" as USER
boundary CMS
boundary Accessplatform as AP
boundary NemId as NEMID
database "Session" as SESSION
database "Drupal" as DRUPAL
boundary LMS


group Basic login

    USER -> CMS: Login
    CMS -> AP: Elevated Client Id + Agency
    
    alt NemId login
        AP -> NEMID:
        NEMID -> USER: Login
        NEMID <- - USER: NemId id + key
        AP <- - NEMID: CPR
        CMS <- - AP: Authorization code
        CMS -> AP:  Authorization code + Client Id and Client Secret
        CMS <- - AP: Access token
        note left 
            Normal User token not retrieved!
        end note
    else Library login
        AP -> USER: Login
        AP  <- - USER: id + pin
        CMS <- - AP: Authorization code
        CMS -> AP:  Authorization code + Client Id and Client Secret
        CMS <- - AP: Access token
        CMS -> AP:  Normal Client Id and Client Secret, userid + pin, Agency
        CMS <- - AP: User access token
        CMS -> SESSION: User access token
    
    end
end

group Get Patron Data from LMS
    alt UserId = CPR
        CMS -> LMS: (Preauth) CPR, Agency
    else No CPR
        CMS -> LMS: UserId + **~~pin~~**, Agency
    end
    CMS <- - LMS: LMS Patron Data
    CMS -> SESSION: Userid, LMS Patron Data
    CMS -> DRUPAL: Userid (hashed), LMS Patron Data (Name, email, blockings)
end
@enduml

PlantUML version 1.2020.20beta13(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>