@startuml
title Shelfmark

' Skinparams '
skinparam monochrome true
'skinparam handwritten true

' Participants
start
/'
        // Look for the marc field to get DK5 classification from. We require
        // that either 'm' or 'o' subfield is present and prefer 652. If this is
        // not the case we'll try the outdated marc field 654 for DK5.
        $field_dk5 = fbs_get_marc_field($entity, '652');
        if (empty($field_dk5['m']) && empty($field_dk5['o'])) {
          $field_dk5 = fbs_get_marc_field($entity, '654');
        }
'/
':Set empty $prefix
:field_dk5 = 652;
if (exists "652 *m || *o" ) then (no)
    :field_dk5 = 654;
endif


/'
        // Non-fiction: Look for the 'sk' marker in both 'm' and 'o' subfield.
        // If it's not present in any of these, we consider the material be to
        // be non-fiction and we should use the special prefix for non-fiction
        // materials.
        if ($field_dk5_m !== 'sk' && $field_dk5_o !== 'sk') {
'/

'if ( *m !== 'sk' \n&& *o !== 'sk') then (yes : Non-fiction)
if ( Neither *m nor *o == 'sk') then (yes : Non-fiction = DK5)
    if (exists *m" ) then (yes)
        :prefix .= *m;
    elseif (exists *o ) then (yes)
        :prefix .= *o;
    else (no)
    endif

endif

stop
@enduml
